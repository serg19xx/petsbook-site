#!/bin/bash

# –ü—Ä–µ—Ñ–∏–∫—Å —Ç–µ–≥–æ–≤ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π
TAG_PREFIX="backup-"

# –ü–æ–ª—É—á–∞–µ–º —Å–∞–º—ã–π –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ç–µ–≥, —Å–æ—Ä—Ç–∏—Ä—É—è –ø–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è
latest_tag=$(git tag --sort=-creatordate | grep "^$TAG_PREFIX" | head -n 1)

# –ü—Ä–æ–≤–µ—Ä–∫–∞: —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Ç–∞–∫–æ–π —Ç–µ–≥
if [[ -z "$latest_tag" ]]; then
  echo "‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω–æ –Ω–∏ –æ–¥–Ω–æ–≥–æ —Ç–µ–≥–∞ —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º '$TAG_PREFIX'."
  exit 1
fi

echo "üîÑ –ü–æ—Å–ª–µ–¥–Ω–∏–π —Ä–µ–∑–µ—Ä–≤–Ω—ã–π —Ç–µ–≥ –Ω–∞–π–¥–µ–Ω: $latest_tag"

# –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
read -p "–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –∫ —ç—Ç–æ–π –≤–µ—Ä—Å–∏–∏? –≠—Ç–æ —É–¥–∞–ª–∏—Ç —Ç–µ–∫—É—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è. (y/n): " confirm
if [[ "$confirm" != "y" && "$confirm" != "Y" ]]; then
  echo "‚ùå –û–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞."
  exit 0
fi

# –°–±—Ä–æ—Å –≤–µ—Ç–∫–∏ –Ω–∞ –Ω–∞–π–¥–µ–Ω–Ω—ã–π —Ç–µ–≥
git reset --hard "$latest_tag"

echo "‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ. –í—ã –Ω–∞ –≤–µ—Ä—Å–∏–∏: $latest_tag"